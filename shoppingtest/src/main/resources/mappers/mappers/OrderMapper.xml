<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop.dao.OrderDAO">

<select id="orderList" resultType="OrderDTO">
select S.ordernum, S.orderdate, P.productimage, P.productname,
 (select SUM(orderprice) from orderdetail where id=#{id} and ordernum=s.ordernum group by ordernum) orderprice , 
 O.ordercount, S.paycheck , S.delivery, P.productnum, P.productkind
from orderdetail O,shoporder S, product p 
where s.ordernum = o.ordernum
and o.productnum = p.productnum
and o.id = #{id}
order by s.ordernum
</select>

<select id="cashOrderList" resultType="OrderDTO">
select S.ordernum, S.orderdate, P.productimage, P.productname, O.orderprice, P.productcontent,
 (select SUM(orderprice) from orderdetail where o.ordernum = #{ordernum} and ordernum=s.ordernum group by ordernum) amount_orderprice , 
 O.ordercount, S.paycheck , S.delivery, P.productnum, P.productkind
from orderdetail O,shoporder S, product p 
where s.ordernum = o.ordernum
and o.productnum = p.productnum
and o.ordernum = #{ordernum}
order by s.ordernum
</select>

<delete id="remove">
BEGIN
	delete from orderdetail where ordernum = #{ordernum};
	delete from shoporder where ordernum = #{ordernum};
END;
</delete>

</mapper>