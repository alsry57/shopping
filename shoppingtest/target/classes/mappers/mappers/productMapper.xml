<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.dao.ProductDAO">

<insert id="create">insert into product values (productnum =#{productnum}, productname =#{productname} ,productkind =#{productkind}
,productprice =#{productprice},productcontent =#{productcontent},productimage =#{productimage},productsales =#{productsalse})</insert>

<select id="read" resultType="ProductDTO"> 
select * from product where productname =#{productname} </select>

<update id="update"> update product set productnum =#{productnum}, productname =#{productname} ,productkind =#{productkind}
,productprice =#{productprice},productcontent =#{productcontent},productimage =#{productimage},productsales =#{productsalse} where productname = #{productname} </update>

<delete id="delete"> delete from product where productname = #{productname} </delete>

<select id="listAll" resultType="ProductDTO">
select * from product</select>

<select id="ProductBestSales" resultType="ProductDTO">
<if test="productkind != ''">
<![CDATA[select * from(SELECT * FROM PRODUCT where productkind like #{productkind} ORDER BY PRODUCTSALES DESC) product where rownum <= 3]]>
</if>
<if test="productkind == ''">
<![CDATA[select * from(SELECT * FROM PRODUCT ORDER BY PRODUCTSALES DESC) product where rownum <= 20]]>
</if>
</select>

<select id="view" resultType="com.shop.dto.ProductDTO"> 
 select 
  productnum, productname, productkind, productprice, productcontent, productimage, productsales
 from 
  product
 where
  productnum = #{productnum} 
</select>

<select id="listSearch" resultType="ProductDTO">
<![CDATA[select productnum, productname, productkind, productprice, productcontent,productimage, productsales from
(select /*+INDEX_DESC(product,pk_product)*/ 
rownum rn, productnum, productname, productkind, productprice,productcontent, productimage, productsales
from product where productkind like #{productkind} and rownum <= #{page} * #{perPageNum} ) where rn > (#{page} -1) * #{perPageNum}]]>
</select>


<select id="listSearchCount" resultType="int">
<![CDATA[ select count(productnum) from product where productkind='appliances' ]]>
</select>
</mapper>
